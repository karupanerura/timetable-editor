!function(t){function e(e){for(var s,a,o=e[0],m=e[1],c=e[2],u=0,p=[];u<o.length;u++)a=o[u],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&p.push(n[a][0]),n[a]=0;for(s in m)Object.prototype.hasOwnProperty.call(m,s)&&(t[s]=m[s]);for(l&&l(e);p.length;)p.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],s=!0,o=1;o<i.length;o++){var m=i[o];0!==n[m]&&(s=!1)}s&&(r.splice(e--,1),t=a(a.s=i[0]))}return t}var s={},n={0:0},r=[];function a(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=s,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var o=window.webpackJsonp=window.webpackJsonp||[],m=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var l=m;r.push([18,1]),i()}([,function(t,e,i){var s=i(4),n=i(10);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var r={insert:"head",singleton:!1},a=(s(t.i,n,r),n.locals?n.locals:{});t.exports=a},function(t,e,i){var s=i(4),n=i(12);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var r={insert:"head",singleton:!1},a=(s(t.i,n,r),n.locals?n.locals:{});t.exports=a},function(t,e,i){var s=i(4),n=i(17);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var r={insert:"head",singleton:!1},a=(s(t.i,n,r),n.locals?n.locals:{});t.exports=a},,,,,,function(t,e,i){"use strict";var s=i(1);i.n(s).a},function(t,e,i){(e=i(5)(!1)).push([t.i,"\n.tracks[data-v-ac172b74] {\n  display: table;\n  width: 100%;\n  height: 64px;\n}\n.track[data-v-ac172b74] {\n  display: table-cell;\n}\n",""]),t.exports=e},function(t,e,i){"use strict";var s=i(2);i.n(s).a},function(t,e,i){(e=i(5)(!1)).push([t.i,"\n.timespans[data-v-566b2f6e] {\n  display: flex;\n  flex-flow: column nowrap;\n  width: 100%;\n}\n.timespan[data-v-566b2f6e] {\n  height: 64px;\n}\n",""]),t.exports=e},,,,function(t,e,i){"use strict";var s=i(3);i.n(s).a},function(t,e,i){(e=i(5)(!1)).push([t.i,"\n.timetable[data-v-2faaf0c1] {\n  display: flex;\n  flex-flow: row nowrap;\n  width: 100%;\n}\n.timetable-timespans[data-v-2faaf0c1] {\n  margin-top: 64px;\n  width: 240px;\n}\n.timetable-contents[data-v-2faaf0c1] {\n  width: 100%;\n}\n",""]),t.exports=e},function(t,e,i){"use strict";i.r(e);var s=i(7),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._m(0),t._v(" "),i("section",{staticClass:"section"},[i("div",{staticClass:"container"},[i("tracks-form",{attrs:{tracks:t.tracks},on:{"update:tracks":function(e){t.tracks=e}}}),t._v(" "),i("timespan-form",{on:{create:t.addTimespan}}),t._v(" "),i("item-form",{on:{create:t.addItem}}),t._v(" "),i("timetable",{attrs:{timetable:t.timetable}}),t._v(" "),i("form",{on:{submit:function(e){return e.preventDefault(),t.exportTimetable(e)}}},[i("button",{attrs:{type:"submit"}},[t._v("\n          Export\n        ")]),t._v(" "),t.exportURL?i("a",{attrs:{href:t.exportURL,download:""}},[t._v("\n          Download\n        ")]):t._e()]),t._v(" "),i("form",{on:{submit:function(e){return e.preventDefault(),t.importTimetable(e)}}},[i("input",{attrs:{type:"file",name:"import-target"},on:{change:t.loadImportTarget}}),t._v(" "),i("button",{attrs:{type:"submit",disabled:!t.loadedContent}},[t._v("\n          Import\n        ")])])],1)])])};n._withStripped=!0;var r=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"timetable"},[e("div",{staticClass:"timetable-timespans"},[e("timespans",{attrs:{items:this.timespans}})],1),this._v(" "),e("div",{staticClass:"timetable-contents"},[e("tracks",{attrs:{count:this.tracks}}),this._v(" "),e("items",{attrs:{grids:this.grids,columns:this.columns,rows:this.rows,"row-height":64}})],1)])};r._withStripped=!0;var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tracks"},t._l(t.tracks,(function(e){return i("div",{key:e,staticClass:"track"},[t._v("\n    "+t._s(e)+"\n  ")])})),0)};a._withStripped=!0;var o={components:{},props:{count:{type:Number,default:2}},data:()=>({}),computed:{tracks(){return function*(t,e,i=1){for(let s=t;s<=e;s+=i)yield s}(1,this.count)}}},m=(i(9),i(0)),c=Object(m.a)(o,a,[],!1,null,"ac172b74",null);c.options.__file="src/components/timetable/tracks.vue";var l=c.exports,u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"timespans"},t._l(t.items,(function(e){return i("div",{key:e.toString(),staticClass:"timespan"},[i("time",[t._v(t._s(e.beginsTime))]),t._v(" ~ "),i("time",[t._v(t._s(e.endsTime))])])})),0)};u._withStripped=!0;var p={components:{},props:{items:{type:Array,default:()=>[]}},data:()=>({})},d=(i(11),Object(m.a)(p,u,[],!1,null,"566b2f6e",null));d.options.__file="src/components/timetable/timespans.vue";var f=d.exports,h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("grid-layout",{attrs:{layout:t.grids,"col-num":t.columns,"max-rows":t.rows,margin:[0,0],"row-height":t.rowHeight,"is-draggable":!0,"is-resizable":!0,"use-css-transforms":!0},on:{"update:layout":function(e){t.grids=e}}},t._l(t.grids,(function(e){return i("grid-item",{key:e.i,attrs:{x:e.x,y:e.y,w:e.w,h:e.h,i:e.i}},[t._v("\n    "+t._s(e.item.title)),i("br"),t._v(" "),i("small",[t._v(t._s(e.item.description))]),t._v(" "),i("small",[t._v("extras: "+t._s(t.encodeJSON(e.item.extras)))]),t._v(" "),i("small",[t._v("grid: "+t._s(t.encodeJSON(e)))])])})),1)};h._withStripped=!0;var v=i(8),g={components:{GridLayout:v.GridLayout,GridItem:v.GridItem},props:{grids:{type:Array,default:()=>[]},columns:{type:Number,default:2},rows:{type:Number,default:2},rowHeight:{type:Number,default:64}},data:()=>({}),methods:{encodeJSON:JSON.stringify}},b=Object(m.a)(g,h,[],!1,null,null,null);b.options.__file="src/components/timetable/items.vue";var _=b.exports;class T{constructor(t,e){this.hour=t,this.minute=e}static parse(t){const[e,i]=t.split(":"),s=e?parseInt(e):0,n=i?parseInt(i):0;return new T(s,n)}static fromDTO(t){return new T(t.hour,t.minute)}addMinutes(t){const e=this.minute+t,i=Math.floor(this.hour+e/60);return new T(i%24,e%60)}compare(t){const e=this.compareHour(t);return 0!==e?e:this.compareMinute(t)}equals(t){return this.hour===t.hour&&this.minute===t.minute}compareHour(t){return this.hour<t.hour?-1:this.hour===t.hour?0:1}compareMinute(t){return this.minute<t.minute?-1:this.minute===t.minute?0:1}toString(){return(this.hour>=10?this.hour.toString():"0"+this.hour.toString())+":"+(this.minute>=10?this.minute.toString():"0"+this.minute.toString())}}class y{constructor(t,e){this.beginsTime=t,this.endsTime=e}static fromDTO(t){const e=T.fromDTO(t.beginsTime),i=T.fromDTO(t.endsTime);return new y(e,i)}isMoment(){return this.beginsTime.equals(this.endsTime)}isValid(){return this.beginsTime.compare(this.endsTime)<=0}compare(t){return this.beginsTime.compare(t.beginsTime)||this.endsTime.compare(t.endsTime)}includes(t){return this.beginsTime.compare(t.beginsTime)<=0&&this.endsTime.compare(t.endsTime)>=0}conflicts(t){return this.beginsTime.compare(t.endsTime)<0&&this.endsTime.compare(t.beginsTime)>0}equals(t){return this.beginsTime.equals(t.beginsTime)&&this.endsTime.equals(t.endsTime)}toString(){return this.isMoment()?this.beginsTime.toString():this.beginsTime.toString()+" ~ "+this.endsTime.toString()}}class w{constructor(t,e,i=new Map){this.title=t,this.description=e,this.extras=i}static fromDTO(t){return new w(t.title,t.description,t.extras)}}const x=(k=0,()=>++k);var k;class S{constructor(t){this.x=0,this.y=0,this.w=1,this.h=1,this.moved=!1,this.id=x(),this.item=t}get i(){return`item[${this.id}]`}static getOrCreate(t){const e=S.cache.get(t);if(e instanceof S)return e;const i=new S(t);return S.cache.set(t,i),i}}function*O(t,e,i=1){for(let s=t;s<=e;s+=i)yield s}S.cache=new WeakMap;class j{constructor(t,e,i,s){this.tracks=t,this.timespans=e,this.items=i,this.grids=s}static create(t,e,i){const s=i.map(S.getOrCreate);return new j(t,e,i,s)}static fromDTO(t){const e=Math.max(...t.items.map(t=>t.trackIds.length)),i=t.timespans.map(y.fromDTO),s=t.items.map(w.fromDTO),n=t.items.map((t,e)=>{const n=y.fromDTO(t.timespan),r=Array.from((t=>{let e=0,s=0,n=0;for(const r of i){if(t.includes(r))0===s&&(s=e),n=e;else if(0!==s)break;e++}return O(s,n)})(n)),a=s[e],o=S.getOrCreate(a);return o.x=t.trackIds[0]-1,o.y=r[0],o.w=t.trackIds.length,o.h=r.length,o});return new j(e,i,s,n)}toDTO(){const t=this.grids.map(t=>{const e=this.timespans[t.y],i=this.timespans[t.y+t.h-1];let s;s=e.equals(i)?e:new y(e.beginsTime,i.endsTime);const n=Array.from(O(t.x+1,t.x+t.w));return{...t.item,timespan:s,trackIds:n}});return{tracks:this.tracks,timespans:this.timespans,items:t}}}var D={components:{Tracks:l,Timespans:f,Items:_},props:{timetable:{type:Object,default:()=>{}}},computed:{timespans(){return this.timetable.timespans},grids(){return this.timetable.grids},rows(){return this.timetable.timespans.length},tracks(){return this.timetable.tracks},columns(){return this.timetable.tracks}}},C=(i(16),Object(m.a)(D,r,[],!1,null,"2faaf0c1",null));C.options.__file="src/components/timetable.vue";var E=C.exports,N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{action:"javascript:void(0)"}},[t._v("\n  tracks: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.tracks,expression:"tracks"}],attrs:{type:"number",name:"tracks",min:"2",max:"8"},domProps:{value:t.tracks},on:{input:function(e){e.target.composing||(t.tracks=e.target.value)}}})])};N._withStripped=!0;var I={props:{tracks:{type:String,default:"2"}},data:()=>({}),watch:{tracks(){this.$emit("update:tracks",this.tracks)}}},M=Object(m.a)(I,N,[],!1,null,null,null);M.options.__file="src/components/tracks-form.vue";var $=M.exports,P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{action:"javascript:void(0)"},on:{submit:function(e){return e.preventDefault(),t.addItem()}}},[t._v("\n  title: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.draftTitle,expression:"draftTitle"}],attrs:{type:"text",name:"title",required:""},domProps:{value:t.draftTitle},on:{input:function(e){e.target.composing||(t.draftTitle=e.target.value)}}}),i("br"),t._v("\n  description: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.draftDescription,expression:"draftDescription"}],attrs:{type:"text",name:"description",required:""},domProps:{value:t.draftDescription},on:{input:function(e){e.target.composing||(t.draftDescription=e.target.value)}}}),t._v(" "),i("button",{attrs:{type:"submit"}},[t._v("\n    add\n  ")])])};P._withStripped=!0;var q={components:{},props:{draftTitle:{type:String,default:""},draftDescription:{type:String,default:""}},data:()=>({}),methods:{addItem(){const t=this.draftTitle,e=this.draftDescription,i=new w(t,e);this.$emit("create",i)}}},B=Object(m.a)(q,P,[],!1,null,null,null);B.options.__file="src/components/item-form.vue";var J=B.exports,L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{action:"javascript:void(0)"},on:{submit:function(e){return e.preventDefault(),t.addTimespan()}}},[t._v("\n  time span: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.draftBeginsTime,expression:"draftBeginsTime"}],attrs:{type:"time",name:"begins-time",step:t.timeStepSeconds,max:t.draftEndsTime,required:"",pattern:"[0-9]{2}:[0-9]{2}"},domProps:{value:t.draftBeginsTime},on:{input:function(e){e.target.composing||(t.draftBeginsTime=e.target.value)}}}),t._v(" ~ "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.draftEndsTime,expression:"draftEndsTime"}],attrs:{type:"time",name:"ends-time",step:t.timeStepSeconds,min:t.draftBeginsTime,required:"",pattern:"[0-9]{2}:[0-9]{2}"},domProps:{value:t.draftEndsTime},on:{input:function(e){e.target.composing||(t.draftEndsTime=e.target.value)}}}),i("button",{attrs:{type:"submit"}},[t._v("\n    add\n  ")]),i("br")])};L._withStripped=!0;var R={props:{timeStep:{type:Number,default:10}},data:()=>({draftBeginsTime:"09:00",draftEndsTime:"09:10"}),computed:{timeStepSeconds(){return 60*this.timeStep}},methods:{addTimespan(){if(""===this.draftBeginsTime)return void alert("begins time is not defined");if(""===this.draftEndsTime)return void alert("ends time is not defined");const t=new y(T.parse(this.draftBeginsTime),T.parse(this.draftEndsTime));t.isValid()?(this.draftBeginsTime=this.draftEndsTime,this.draftEndsTime=T.parse(this.draftBeginsTime).addMinutes(this.timeStep).toString(),this.$emit("create",t)):alert(t+" is invalid timespan")}}},A=Object(m.a)(R,L,[],!1,null,null,null);A.options.__file="src/components/timespan-form.vue";var U={components:{Timetable:E,TracksForm:$,ItemForm:J,TimespanForm:A.exports},data:()=>({tracks:"2",timespans:[],items:[],loadedContent:null,exportURL:null}),computed:{tracksNum(){return parseInt(this.tracks)},timetable(){return j.create(this.tracksNum,this.timespans,this.items)}},methods:{addItem(t){this.items.push(t)},addTimespan(t){if(this.timespans.filter(e=>e.equals(t)).length>0)return;const e=this.timespans;e.map(e=>t.conflicts(e)).reduce((t,e)=>t||e,!1)?alert("Conflict time span: "+this.beginsTime+" ~ "+this.endsTime):(e.push(t),this.timespans=e.sort((t,e)=>t.compare(e)))},exportTimetable(){const t=JSON.stringify(this.timetable.toDTO()),e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e);this.exportURL=i},loadImportTarget(t){const e=t.target.files[0];"application/json"!==e.type&&alert("File is not JSON");const i=new FileReader;i.onload=t=>{this.loadedContent=t.target.result},i.readAsText(e)},importTimetable(){const t=JSON.parse(this.loadedContent),e=j.fromDTO(t);this.tracks=e.tracks.toString(),this.timespans=e.timespans,this.items=e.items}}},F=Object(m.a)(U,n,[function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"hero"},[e("div",{staticClass:"hero-body"},[e("div",{staticClass:"container"},[e("h1",{staticClass:"title"},[this._v("\n          Timetable Editor\n        ")]),this._v(" "),e("h2",{staticClass:"subtitle"},[this._v("\n          Web Timetable Editor\n        ")])])])])}],!1,null,null,null);F.options.__file="src/App.vue";var G=F.exports;new s.default({render:t=>t(G)}).$mount("#app")}]);